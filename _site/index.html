<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ea4.ninja</title>
	<meta name="keywords" content="EA4, EA, EasyApache, EasyApache4, EA3, cPanel, WHM, Apache, PHP, rpm, SPECS, sources">
	<meta name="description" content="Assorted bits of information on EasyApache4">
  <link rel="stylesheet" href="combo.css">
  <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="img/apple-touch-icon.png">
</head>
<body>
  <div id="main">

    <nav><ul>
      
        
        <li class="p-intro"><a href="#intro">home</a></li>
      
        
        <li class="p-setup"><a href="#setup">Setup</a></li>
      
        
        <li class="p-basics"><a href="#basics">Basics</a></li>
      
        
        <li class="p-patch"><a href="#patch">Patch</a></li>
      
        
        <li class="p-create"><a href="#create">Create</a></li>
      
        
        <li class="p-links"><a href="#links">links</a></li>
      
        
        <li class="p-about"><a href="#about">About</a></li>
      
    </ul></nav>


    
      
      <div id="intro" class="section p-intro">
        
        <div class="container center">
          <h3 class="text-purple"><em>Building Packages</em></h3>
<h1>For EasyApache 4!</h1>

<p><span class="fa-stack subtlecircle" style="font-size:100px; background:rgba(255,166,0,0.1)">
	<img src="img/ninja.png" />
</span></p>

<p class="text-purple">Like a ninja</p>

        </div>
      </div>
    
      
      <div id="setup" class="section p-setup">
        
        <div class="subtlecircle sectiondivider faicon">
          <span class="fa-stack">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-wrench fa-stack-1x"></i>
          </span>
          <h5 class="icon-title">Setup</h5>
        </div>
        
        <div class="container ">
          <h2>Setup</h2>

<p>Open Build Service is used for numerous things in the EA4 stack, it is usable as both a software code repository and build system. It works via both the cli utility <code class="highlighter-rouge">osc</code> and via the <a href="https://build.opensuse.org/">Open Build Service</a> website. For most actions you will need to use both the utility and the website.</p>

<p>To to get started with using OBS, you will need:</p>

<ol>
  <li>An account on SuSE’s excellent <a href="https://build.opensuse.org">Open Build Service</a></li>
  <li>The ‘osc’ Utility
    <ul>
      <li>From your distributions package manager</li>
      <li>ubuntu/debian: sudo apt-get install osc</li>
      <li>Other distros, see the <a href="http://download.opensuse.org/repositories/openSUSE:/Tools/">OpenSuSE Tools Repository</a> after check your package manager for the ‘osc’ package.</li>
    </ul>
  </li>
  <li>run the <code class="highlighter-rouge">osc</code> command and input your account information
    <ul>
      <li>NOTE: this will create a file at ~/.oscrc with cleartext credentials, treat accordingly.</li>
    </ul>
  </li>
</ol>

        </div>
      </div>
    
      
      <div id="basics" class="section p-basics">
        
        <div class="subtlecircle sectiondivider faicon">
          <span class="fa-stack">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-book fa-stack-1x"></i>
          </span>
          <h5 class="icon-title">Basics</h5>
        </div>
        
        <div class="container ">
          <h2>Basic OBS Usage</h2>

<hr />

<p>The osc utility allows you to interact with source files using an SVN-like interface, make local builds and numerous other things used in lifecycle management. run <code class="highlighter-rouge">osc help</code> to see a full list of all the command available.</p>

<p>Some basic common commands are:</p>

<ul>
  <li><code class="highlighter-rouge">osc ls isv:cpanel:EA4</code> - See all packages hosted to cPanel’s EasyApache4 repository</li>
  <li><code class="highlighter-rouge">osc branch isv:cpanel:EA4 scl-php71 home:$MY_USER:$BRANCH_NAME</code> branch the scl-php71 package into your own branch</li>
  <li><code class="highlighter-rouge">osc co home:$MY_USER:$BRANCH_NAME</code> Checkout a branch to a local working directory</li>
  <li><code class="highlighter-rouge">osc addremove .</code> add all files and track all removals from a directory (useful before a commit)</li>
  <li><code class="highlighter-rouge">osc ci -m "my commit"</code> commit your changes</li>
  <li><code class="highlighter-rouge">osc build</code> build a local copy of your package</li>
</ul>

        </div>
      </div>
    
      
      <div id="patch" class="section p-patch">
        
        <div class="subtlecircle sectiondivider faicon">
          <span class="fa-stack">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-plus-square fa-stack-1x"></i>
          </span>
          <h5 class="icon-title">Patch</h5>
        </div>
        
        <div class="container ">
          <h2>Patch</h2>

<hr />

<p>Patching an RPM is a reletively easy process that involves a few small updates to the SPEC (specification) file and adding the patch file to the repository.</p>

<ol>
  <li>Branch that package you are wanting to patch using <code class="highlighter-rouge">osc br isv:cpanel:EA4 some_package home:$MY_USER:$MY_PATCHED</code> and then cd into the directory with the content in it.</li>
  <li>Open the .spec file in your editor of choice</li>
  <li>Update the following fields:
    <ul>
      <li>Update the number next to <code class="highlighter-rouge">release_prefix</code> by one. This is used to indicate the number of changes to a specific version of software</li>
      <li>Add a Patch###: line with a unique patch file and number after the other Patch directives</li>
      <li>example: <code class="highlighter-rouge">Patch100: foo.patch</code></li>
      <li>in the %prep section, after the other %patch directives add your patch directive</li>
      <li>example: <code class="highlighter-rouge">%patch 100 -p1 -b foo</code></li>
      <li>Add a new changelog entry in the %changelog section describing your change. See other entries for example format.</li>
    </ul>
  </li>
  <li>Copy the .patch file into the checked out directory and add it to the repository using <code class="highlighter-rouge">osc add $filename</code></li>
  <li>Test your change locally using <code class="highlighter-rouge">osc build</code></li>
  <li>Commit your changes using <code class="highlighter-rouge">osc ci -m "some message"</code></li>
</ol>

        </div>
      </div>
    
      
      <div id="create" class="section p-create">
        
        <div class="subtlecircle sectiondivider faicon">
          <span class="fa-stack">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-paint-brush fa-stack-1x"></i>
          </span>
          <h5 class="icon-title">Create</h5>
        </div>
        
        <div class="container ">
          <h2>Create</h2>

<hr />

<h4>Create your package branch</h4>

<p>It is easiest to start this by branching a package from isv:cpanel:EA4 and immediately removing it as this will set up the build dependencies for you.</p>

<p>See <code class="highlighter-rouge">osc help $command</code> for more information on each of these commands (f.ex. <code class="highlighter-rouge">osc help mkpac</code>)</p>

<p><code class="highlighter-rouge">osc branch isv:cpanel:EA4 scl-php71 home:$MY_USER:new_package</code></p>

<p><code class="highlighter-rouge">osc co home:geckmatic:new_package</code></p>

<p><code class="highlighter-rouge">cd home:geckmatic:new_package</code></p>

<p><code class="highlighter-rouge">osc delete scl-php71</code></p>

<p><code class="highlighter-rouge">osc mkpac ea-php-php56-yaml</code></p>

<p><code class="highlighter-rouge">osc ci -m "delete this package and add the new package"</code></p>

<h4>Add your sources and packages</h4>
<p>Now you can change directory into the <code class="highlighter-rouge">ea-php56-php-yaml</code> and add your sources and spec file.</p>

<p>For creating new packages we have provided a <a href="https://github.com/CpanelInc/ea4-example-specs">repository</a> containing template specifications and example implementation on <a href="https://github.com/CpanelInc/ea4-example-specs">GitHub</a>. Editing the template file from this repo and filling in items between the <code class="highlighter-rouge">[% %]</code> tags should result in a building RPM. To see an example of this already completed, look at the differences between the .template file and the .spec file. For basic information on how build RPMs, please see <a href="http://www.rpm.org/max-rpm/">Maximum RPM</a></p>

<ol>
  <li>Place the .spec file in the package directory (<code class="highlighter-rouge">home:$MY_USER:newpackage/ea-php-php56-yaml</code>)</li>
  <li>Copy all the sources into the package directory
    <ul>
      <li>if you just want to build the example given here, just copy the contents of the SOURCES/ from the example directory of your choice into the package directory</li>
    </ul>
  </li>
  <li>run <code class="highlighter-rouge">osc addremove .</code> on the package directory</li>
  <li><code class="highlighter-rouge">osc build</code> to test your change locally</li>
  <li><code class="highlighter-rouge">osc ci -m "First commit"</code> to commit to OBS</li>
</ol>

<p>View the Project page on <a href="https://build.opensuse.org">Open Build Server</a> to monitor build status or run <code class="highlighter-rouge">osc results</code>.</p>

<p>Visit the repository on <a href="http://download.opensuse.org/repositories/">download.opensuse.org</a> or run <code class="highlighter-rouge">osc getbinaries</code>.</p>

        </div>
      </div>
    
      
      <div id="links" class="section p-links">
        
        <div class="subtlecircle sectiondivider faicon">
          <span class="fa-stack">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-link fa-stack-1x"></i>
          </span>
          <h5 class="icon-title">links</h5>
        </div>
        
        <div class="container ">
          <h2>Links</h2>

<hr />
<p><a href="2016.pdf">Made Easy: A Builder’s guide to EA4</a> - 2016 cPanel Conference presentation</p>

<p><a href="https://cpanel.com">cPanel, Inc.</a> for creating ea4.</p>

<p><a href="http://openbuildservice.org/">Open Build Service Software</a> for information on running your own local copy of Open Build Service.</p>

        </div>
      </div>
    
      
      <div id="about" class="section p-about">
        
        <div class="subtlecircle sectiondivider faicon">
          <span class="fa-stack">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-plug fa-stack-1x"></i>
          </span>
          <h5 class="icon-title">About</h5>
        </div>
        
        <div class="container center">
          <hr />

<h1>Jacob Perkins</h1>

<p><a href="https://www.twitter.com/jperkster">
	<span class="fa-stack subtlecircle" style="font-size:100px; background:rgba(255,166,0,0.1)">
 	<i class="fa fa-circle fa-stack-2x text-white"></i>
 	<i class="fa fa-twitter fa-stack-1x text-black"></i>
</span></a></p>

<p><a href="https://www.linkedin.com/in/houstondad">
	<span class="fa-stack subtlecircle" style="font-size:100px; background:rgba(255,166,0,0.1)">
 	<i class="fa fa-circle fa-stack-2x text-white"></i>
 	<i class="fa fa-linkedin fa-stack-1x text-black"></i>
</span>
</a></p>

<hr />

<h1>Matt Dees</h1>

<p><a href="https://www.github.com/MattDees/">
	<span class="fa-stack subtlecircle" style="font-size:100px; background:rgba(255,166,0,0.1)">
 	<i class="fa fa-circle fa-stack-2x text-white"></i>
 	<i class="fa fa-github fa-stack-1x text-black"></i>
</span></a></p>

<p><a href="https://www.linkedin.com/in/mdees">
	<span class="fa-stack subtlecircle" style="font-size:100px; background:rgba(255,166,0,0.1)">
 	<i class="fa fa-circle fa-stack-2x text-white"></i>
 	<i class="fa fa-linkedin fa-stack-1x text-black"></i>
</span>
</a></p>

        </div>
      </div>
    


    <div id="footer" class="section text-white">
      <div class="container">
        
        
<p>Design by Tim O’Brien <a href="http://t413.com/">t413.com</a>
—
<a href="https://github.com/t413/SinglePaged">SinglePaged theme</a>
—
this site is <a href="https://github.com/t413/SinglePaged">open source</a></p>


      </div>
    </div>
  </div>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-49607422-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="site.js"></script>
</html>
